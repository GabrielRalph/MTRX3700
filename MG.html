<!doctype html>
<html>
  <head>
    <title>A3</title>
    <script src = "https://www.svg.plus/vector.js"></script>
    <script>


    class PlusError{
      constructor(message, class_name = "Object"){
        this.msg = message;
        this.cls = class_name;
        let stack = new Error('helloworld');
        this.stack = stack.stack

      }
      _parse_stack(){
        let stack = this.stack
        let lines = stack.split('at ');
        let message = '';
        let con = 0;
        let tab = "";
        for (var i = 2; i < lines.length-1; i++){
          let conf = false;

          let clas = null;
          let lctn = null;
          let mthd = null;

          let line = lines[i];
          line = lines[i].replace(/\t|\n|\[.*\] |  +/g, '').replace(/ \((.*)\)/g, (a,b) =>{
            b = b.split('/');
            b = b[b.length - 1];
            b = b.split(':')

            lctn = `${b[0]} line ${b[1]}`;
            return ''
          })
          let parts = line.split(/ |\./g);

          if (parts.length === 3 && parts[1] == "get" || parts[1] == "set"){
            mthd = `${parts[1]}ting ${parts[2]} of ${parts[0]}\t (${lctn})`
          }else if(parts.length == 2){
            mthd = `whilst calling ${parts[1]} of ${parts[0]}\t (${lctn})`
          }
          if (parts[0] === 'new'){
            con++;
            conf = true;
            mthd = `whilst constructing new ${parts[1]}\t (${lctn})`
            clas = parts[1];
          }else if(parts[0] === 'Object'){
            clas = this.cls;
          }else{
            clas = parts[0];
          }
          if ((conf && con == 1)||(!conf)){
            message = mthd + '\n' + tab + message;
          }
          tab += '\t'
          // stack_data.push(this._stack_line_parser(line))
        }
        return 'Error\n' + message + tab + this.msg
        // console.log(stack_data);
      }

      toString(){
        return this._parse_stack()
      }
    }



    class SvgPlus{
      constructor(el){
        el = SvgPlus.parseElement(el);
        let prototype = Object.getPrototypeOf(this);
        return SvgPlus.extend(el, prototype);
      }


      set styles(styles){
        if (typeof styles !== 'object'){
          throw `Error setting styles:\nstyles must be set using an object, not ${typeof styles}`
          return
        }
        this._style_set = typeof this._style_set != 'object' ? {} : this._style_set;
        for (var style in styles){
          var value = `${styles[style]}`
          if (value != null){
            let set = true;
            try{
              this.style.setProperty(style, value);
            }catch(e){
              set = false;
              throw e
            }
            if (set){
              this._style_set[style] = value;
            }
          }
        }
      }
      get styles(){
        return this._style_set;
      }
      set props (props){
        if (typeof props !== 'object'){
          throw `Error setting styles:\nstyles must be set using an object, not ${typeof props}`
          return
        }
        this._prop_set = typeof this._prop_set != 'object' ? {} : this._prop_set;
        for (var prop in props){
          var value = props[prop]
          if (prop == 'style' || prop == 'styles'){
            this.styles = value
          }else if (value != null){
            let set = true;
            try{
              this.setAttribute(prop,value);
            }catch(e){
              set = false;
              throw e
            }
            if (set){
              this._prop_set[prop] = value;
            }
          }
        }
      }
      get props(){
        return this._prop_set;
      }
      makeChild(name, props = null){
        let child = new SvgPlus(name)
        this.appendChild(child);
        return child;
      }

      animateAlgorithm(algorithm){
        try{
          if (!(algorithm.begin instanceof Function)) throw '' + new PlusError(`Aglorithm's must contain a begin function`);
          if (!(algorithm.next instanceof Function)) throw '' + new PlusError(`Aglorithm's must contain a next function`);
          if (!(algorithm.end instanceof Function)) throw '' + new PlusError(`Aglorithm's must contain a end function`);
        }catch(e){
          throw e;
          return;
        }


        try{
          algorithm.begin(this);
        }catch(e){
          throw e;
          return;
        }

        let nextFrame = (t) => {
          if (algorithm.next(t)){
            window.requestAnimationFrame(nextFrame);
          }else{
            algorithm.end();
          }
        }
        window.requestAnimationFrame(nextFrame);

      }

      static make(name){
        if (`animate animateMotion animateTransform circle clipPath
          color-profile defs desc discard ellipse feBlend feColorMatrix
          feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting
          feDisplacementMap feDistantLight feDropShadow feFlood feFuncA
          feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode
          feMorphology feOffset fePointLight feSpecularLighting feSpotLight
          feTile feTurbulence filter foreignObject g hatch hatchpath image
          line linearGradient marker mask mesh meshgradient meshpatch meshrow
          metadata mpath path pattern polygon polyline radialGradient rect
          script set solidcolor stop style svg switch symbol text textPath
          title tspan unknown use view`.indexOf(name) != -1){
          return document.createElementNS("http://www.w3.org/2000/svg", name);

        }else{
          return document.createElement(name);
        }
      }
      static parseElement(elem = null) {
        if (elem == null){
          throw `${new PlusError('null element given to parser')}`
        }
        if (typeof elem === 'string'){
          let _elem = null;
          if((/<.*?><.*?>/g).test(elem)){
            try{
              _elem = SvgPlus.parseSVGString(elem)
            }catch(e){
              throw e
            }
          }else{
            _elem = document.getElementById(elem);
          }

          if (_elem == null){
            _elem = SvgPlus.make(elem);
          }


          if (_elem == null){
            throw `${new PlusError(`Could not parse ${elem}.`)}`
            return null
          }else{
            try {
              _elem = this.parseElement(_elem);
            }catch(e){
              throw e
              return null
            }
            return _elem
          }
        }else if (elem instanceof Element){
          return elem
        }else{
          throw 'invalid element'
          return null
        }
      }
      static parseSVGString(string){
        let parser = new DOMParser()
        let doc = parser.parseFromString(string, "image/svg+xml");
        let errors = doc.getElementsByTagName('parsererror');
        if (errors && errors.length > 0){
          throw '' + new PlusError(`${errors[0]}`)
          return null
        }
        return doc.firstChild
      }
      static extend(elem, proto){
        let keys = Object.getOwnPropertyNames(proto);
        if (proto != Object.prototype){
          let _proto = Object.getPrototypeOf(proto);
          elem = SvgPlus.extend(elem, _proto);
        }else{
          return elem
        }
        let build = false
        keys.forEach((key) => {
          if (key != 'constructor'){
            var prop = Object.getOwnPropertyDescriptor(proto, key);
            if (key == 'build'){
              Object.defineProperty(elem, 'plus_constructor', prop);
              build = true;
            }else{
              if (key in elem && elem[key]){
                try {
                  elem[key] = proto[key];
                }catch (e){
                  throw '' + new PlusError(`The class property ${key} was unable to be set\n${e}`);
                }
              }else{
                Object.defineProperty(elem, key, prop);
              }
            }
          }
        })
        if(build){ elem.plus_constructor()}
        return elem;
      }
    }

    </script>
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
      };
    </script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
      </script>

  </head>
  <body>
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
      	 viewBox="0 0 400 231.6" style="enable-background:new 0 0 400 231.6;" xml:space="preserve">
      <polygon style="fill:#A9A8A9;" points="252.5,191.5 191.5,207.6 122.4,167.2 106.4,106.2 146.8,36.9 293,122.3 "/>
      <g>
      	<g>
      		<line style="fill:none;stroke:#378C42;stroke-miterlimit:10;" x1="221.6" y1="76.6" x2="272.2" y2="106.2"/>
      		<g>
      			<polygon style="fill:#378C42;" points="266.1,105.9 266.2,105.1 272.1,106.1 268.3,101.5 269,100.9 274.4,107.5 			"/>
      		</g>
      	</g>
      </g>
      <g>
      	<path style="fill:none;stroke:#25326D;stroke-linecap:round;stroke-miterlimit:10;" d="M134.1,105.3L134.1,105.3
      		c-1.4-0.8-1.9-2.7-1.1-4.1l21-36c0.8-1.4,2.7-1.9,4.1-1.1l0,0c1.4,0.8,1.9,2.7,1.1,4.1l-21,36C137.3,105.7,135.5,106.1,134.1,105.3
      		z"/>
      	<path style="fill:none;stroke:#BC2026;stroke-linecap:round;stroke-miterlimit:10;" d="M239.7,167L239.7,167
      		c-1.4-0.8-1.9-2.7-1.1-4.1l21-36c0.8-1.4,2.7-1.9,4.1-1.1v0c1.4,0.8,1.9,2.7,1.1,4.1l-21,36C242.9,167.3,241.1,167.8,239.7,167z"/>
      </g>
      <circle cx="166.2" cy="171.5" r="4"/>
      <g>
      	<g>
      		<line style="fill:none;stroke:#25326D;stroke-linecap:round;stroke-miterlimit:10;" x1="158.1" y1="64.2" x2="177.7" y2="30.6"/>
      		<g>
      			<polygon style="fill:#25326D;" points="177.5,37.3 176.5,37.1 177.6,30.7 172.6,34.9 172,34.1 179.1,28.2 			"/>
      		</g>
      	</g>
      </g>
      <g>
      	<g>
      		<line style="fill:none;stroke:#BC2026;stroke-linecap:round;stroke-miterlimit:10;" x1="263.7" y1="125.8" x2="294.2" y2="73.5"/>
      		<g>
      			<polygon style="fill:#BC2026;" points="294,80.2 293,80 294.2,73.6 289.2,77.8 288.5,77 295.7,71 			"/>
      		</g>
      	</g>
      </g>
      <text transform="matrix(1 -5.040000e-03 5.040000e-03 1 180.4594 28.37)" style="fill:#25326D; font-family:'TimesNewRomanPS-ItalicMT'; font-size:7px;">VL</text>
      <text transform="matrix(0.9995 3.075000e-02 -3.075000e-02 0.9995 243.6747 38.1522)" style="fill:#713E98; font-family:'TimesNewRomanPS-ItalicMT'; font-size:8.1481px;">VO</text>
      <text transform="matrix(0.9849 0.1728 -0.1728 0.9849 246.1571 88.504)" style="fill:#378C42; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">d</text>
      <text transform="matrix(0.8636 0.5042 -0.5042 0.8636 99.8478 54.7114)" style="fill:#A87363; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">r</text>
      <text transform="matrix(1 2.050000e-03 -2.050000e-03 1 296.9913 68.7761)" style="fill:#BC2026; font-family:'TimesNewRomanPS-ItalicMT'; font-size:7px;">MR</text>
      <g>
      	<g>
      		<line style="fill:none;stroke:#713E98;stroke-linecap:round;stroke-miterlimit:10;" x1="198" y1="117.1" x2="241.6" y2="42.5"/>
      		<g>
      			<polygon style="fill:#713E98;" points="241.3,49.2 240.3,49 241.5,42.6 236.5,46.7 235.8,46 243,40 			"/>
      		</g>
      	</g>
      </g>
      <g>
      	<g>
      		<path style="fill:none;stroke:#9758A3;stroke-linecap:round;stroke-miterlimit:10;" d="M206.3,121.8c-0.9,1.6-2.3,2.9-4,3.8
      			c-4.7,2.4-10.4,0.5-12.8-4.2c-2.4-4.7-0.5-10.4,4.2-12.8c1.7-0.8,3.5-1.1,5.2-1"/>
      		<g>
      			<polygon style="fill:#9758A3;" points="202.2,123.8 202.6,124.3 206,121.7 205.1,125.8 205.7,126 207,120.1 			"/>
      		</g>
      	</g>
      </g>
      <path style="fill:none;stroke:#25326D;stroke-linecap:round;stroke-miterlimit:10;" d="M184,125"/>
      <path style="fill:#D68A6D;" d="M42.3-73.1C86-47.6,100.7,8.6,75.2,52.3S-6.4,110.8-50.2,85.2"/>
      <line style="fill:none;stroke:#BC2026;stroke-linecap:round;stroke-miterlimit:10;" x1="241.2" y1="164.3" x2="261.6" y2="129.3"/>
      <line style="fill:none;stroke:#25326D;stroke-linecap:round;stroke-miterlimit:10;" x1="135.7" y1="102.5" x2="156.2" y2="67.5"/>
      <g style="opacity:0.75;">
      	<g>
      		<line style="fill:none;stroke:#A87363;stroke-miterlimit:10;stroke-dasharray:2,4;" x1="1.6" y1="2.3" x2="197.9" y2="117.2"/>
      		<g>
      			<path style="fill:#A87363;" d="M-0.3,5.5c-1.8-1-2.4-3.4-1.3-5.1C-0.6-1.4,1.7-2,3.5-1c1.8,1,2.4,3.4,1.3,5.1
      				C3.8,6,1.5,6.6-0.3,5.5z"/>
      		</g>
      		<g>
      			<polygon style="fill:#A87363;" points="193,119 192.8,118.1 197.6,117 196.2,112.3 197.1,112 198.9,117.7 			"/>
      		</g>
      	</g>
      </g>
      <g>
      	<g>
      		<polyline style="fill:none;stroke:#7976AD;stroke-linecap:round;stroke-miterlimit:10;stroke-dasharray:2,4;" points="198,44.1
      			198,117.1 240.8,117.1 		"/>
      		<g>
      			<polygon style="fill:#7976AD;" points="194.8,50 195.8,50.4 198,44.2 200.2,50.4 201.2,50 198,41.3 			"/>
      		</g>
      		<g>
      			<polygon style="fill:#7976AD;" points="234.9,120.3 234.5,119.3 240.7,117.1 234.5,114.8 234.9,113.9 243.6,117.1 			"/>
      		</g>
      	</g>
      </g>
      <text transform="matrix(1 0 0 1 200 42.7808)" style="fill:#7976AD; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">vsin(ัฒ)</text>
      <g>
      	<g>
      		<g>
      			<polyline style="fill:none;stroke:#B3B3B3;stroke-linecap:round;stroke-miterlimit:10;stroke-dasharray:2,4;" points="
      				18.8,166.9 18.8,208.9 61.6,208.9 			"/>
      			<g>
      				<polygon style="fill:#B3B3B3;" points="15.6,172.8 16.5,173.1 18.8,167 21,173.1 22,172.8 18.8,164.1 				"/>
      			</g>
      			<g>
      				<polygon style="fill:#B3B3B3;" points="55.7,212.1 55.3,211.2 61.5,208.9 55.3,206.7 55.7,205.8 64.4,208.9 				"/>
      			</g>
      		</g>
      	</g>

      		<text transform="matrix(1 0 0 1 61.4815 204.1622)" style="fill:#B3B3B3; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">x</text>

      		<text transform="matrix(1 0 0 1 23.7502 166.6338)" style="fill:#B3B3B3; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">y</text>
      </g>
      <text transform="matrix(1 0 0 1 239.1697 113.1364)" style="fill:#7976AD; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">vcos(ัฒ)</text>
      <text transform="matrix(1 0 0 1 215.1248 108.5795)" style="fill:#7976AD; font-family:'TimesNewRomanPS-ItalicMT'; font-size:9px;">ัฒ</text>
      <g>

      		<text transform="matrix(0.9997 2.591000e-02 -2.591000e-02 0.9997 157.3246 134.758)" style="fill:#9758A3; font-family:'TimesNewRomanPS-ItalicMT'; font-size:8.1481px;">ัฒ = (ML - MR)/2d</text>
      	<circle style="fill:#9758A3;" cx="161.6" cy="127.6" r="0.6"/>
      </g>
      <g>
      	<g>
      		<path style="fill:none;stroke:#7976AD;stroke-width:0.5;stroke-linecap:round;stroke-miterlimit:10;stroke-dasharray:2,2;" d="
      			M215.1,117.1c0-5.8-2.9-10.9-7.3-14"/>
      		<g>
      			<polygon style="fill:#7976AD;" points="211.1,103.6 210.9,104.1 207.8,103.2 209.6,105.9 209.2,106.2 206.6,102.3 			"/>
      		</g>
      	</g>
      </g>
    </svg>
    <p>
      $V_L = V_R + \omega_{RL} * r_{RL}$
    </p>
    <p>
      $V_L - V_R =  |\omega_{RL}| * k * [-2di]$
    </p>
    <p>
      $V_L - V_R = |\omega_{RL}| * (-2dj) $
    </p>
    <p>
      $\cfrac{V_R - V_L}{2d}k = \omega_{RL}$
    </p>
    <p>
      $V_O = V_R + \omega_{RO} * r_{RO}$
    </p>
    <p style = "color: grey">
      $\omega_{RO} = \omega_{RL} = \cfrac{V_R - V_L}{2d}k$
    </p>
    <p>
      $V_O = V_R + \cfrac{V_R - V_L}{2d}k * [-di]$
    </p>
    <p>
      $V_O = V_R - \cfrac{V_R - V_L}{2}j$
    </p>
    <p>
      $V_O = \cfrac{V_L + V_R}{2}$
    </p>

    <p>
      $V_O = i|V_O|cos(\theta) + j|V_O|sin(\theta)$
    </p>
    <p>
      $\frac{d\theta}{dt} = \cfrac{V_R - V_L}{2d}$
    </p>
    <p>
      $V_R, V_L = [-MAX, MAX]$
    </p>
    max_yaw = <input id = "yaw"/>, <br />
    max_speed = <input id = "speed" />
    <svg id = "regi" viewBox = "-100 -100 200 200">
    </svg>

  </body>

  <script>
    let svg = new SvgPlus('regi');
    class Box extends SvgPlus{
      build(){
        this.props = {fill: 'rgba(255,255,255,0.5)'}
      }
      set max_yaw(num){
        this._max_yaw = parseFloat(num);
        this.draw();
      }
      set max_speed(num){
        this._max_speed = parseFloat(num);
        this.draw();
      }

      draw(){
        let z = new Vector(0,0);
        let s = new Vector(this._max_speed);
        let y = new Vector(this._max_yaw);
        y.x = -1*y.x;
        console.log(y);
        let p1 = s.div(2).add(y.div(2));
        let dp2 = z.sub(s);
        let dp3 = z.sub(y);
        console.log(p1);
        console.log(`M${p1}l${dp2}l${dp3}l${s}z`);
        this.props = {d: `M${p1}l${dp2}l${dp3}l${s}z`}
      }
    }




    class Region{
      begin(svg){
        this.svg = svg;
        this.g = this.svg.makeChild('g');
        this.pos = new Vector(-100, -100);
        let xaxis = this.svg.makeChild('path');
        xaxis.props = {stroke: 'white', d: 'M100,0L-100,0'}
        this.svg.styles = {transform: 'scale(1, -1)'}


        let xtext = this.svg.makeChild('text');
        xtext.props = {'font-size': '5px', fill: 'white', x: 90, y: -2}
        xtext.innerHTML = 'VR';
        xtext.styles = {transform: 'scale(1, -1)'}

        let ytext = this.svg.makeChild('text');
        ytext.props = {'font-size': '5px', fill: 'white', x: 2, y: -90}
        ytext.innerHTML = 'VL';
        ytext.styles = {transform: 'scale(1, -1)'}


        let yaxis = this.svg.makeChild('path');
        yaxis.props = {stroke: 'white', d: 'M0,100L0,-100'}

      }

      inc(){
        this.pos.x++;
        if (this.pos.x > 100){
          this.pos.x = -100;
          this.pos.y++;
          if (this.pos.y > 100) return false;
          return true;
        }else{
          return true;
        }
      }

      next(){
        for (var i = 0; i < 200; i++){
          let dtheta = (this.pos.x - this.pos.y)*2;
          let v_norm = Math.abs(2.5*(this.pos.x + this.pos.y)/2);
          let path = this.g.makeChild('path');
          path.props = {'stroke': `rgb(${dtheta}, ${dtheta*-1}, ${v_norm})`, 'stroke-linecap': 'square', 'stroke-width': '1.1'}
          path.props = {d: `M${this.pos}L${this.pos}`}
          if ( !this.inc() ) return false;
        }
        return true;
      }
      end(){
        let box = new Box('path');
        let yaw = document.getElementById('yaw');
        let speed = document.getElementById('speed');

        yaw.oninput = () => {
          box.max_yaw = yaw.value;
        }
        speed.oninput = () => {
          box.max_speed = speed.value;
        }

        this.svg.appendChild(box);
      }
    }
    svg.animateAlgorithm(new Region())


  </script>
<style>
  svg{
    width: 80vw;
  }
  body{
    width: 80vw;
    height: calc( 100vw * 297 / 210 - 20vw);
    padding: 10vw;
    margin: 0;
  }
  @media print {
    h1:nth-of-type(n + 2) { page-break-before: always; } /* page-break-after works, as well */
  }
</style>
</html>

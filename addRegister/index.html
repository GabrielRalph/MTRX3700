<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MTRX3700</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,271;0,335;1,382;1,409&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src= "https://www.gstatic.com/firebasejs/7.14.4/firebase.js"></script>
  <script src= "../Registers PIC18F452/register.js"></script>
  <script src= "../RichTextEditor.js"></script>
  <link href="../Registers PIC18F452/register.css" rel="stylesheet">
  <link href="./styles.css" rel="stylesheet">
  <script type="text/javascript" src="../Registers PIC18F452/hints.js"></script>

  <body>
    <div id = 'add-register'>
      <register :value = "this" key = "only" @click = "registerClickHandler"></register>
      <div v-if = "edit_byte">
        <div @click = "edit_byte = false" class = "btn">
          add bit
        </div>
        <div style="top: 60px" @click = "save" class = "btn">
          save
        </div>
        <div>
          <h3>Name</h3>
          <input v-model = "name"/>
        </div>
        <div>
          <texteditor v-model = "description"></texteditor>
        </div>
      </div>
      <div v-else class = "inputs">
        <div class = "btn" @click = "addBit">
          add
        </div>
        <div style="top: 60px" @click = "clearBit" class = "btn">
          clear
        </div>
        <div style="top: 120px" @click = "back" class = "btn">
          back
        </div>
        <div>
          <h3>Name</h3>
          <input v-model = "temp_bit.name"/>
        </div>
        <div>
          <h3>MCLR</h3>
          <input v-model = "temp_bit.MCLR"/>
        </div>
        <div>
          <h3>POBO</h3>
          <input v-model = "temp_bit.POBO"/>
        </div>
        <div>
          <h3>rw</h3>
          <input v-model = "temp_bit.rw"/>
        </div>
        <div>
          <h3>Description</h3>
          <texteditor v-model = "temp_bit.description" ></texteditor>
        </div>
      </div>
    </div>
    <div id = "hints">

    </div>
  </body>
  <script type="text/javascript">
    const firebaseConfig = {
      apiKey: "AIzaSyDniS0prRjEmOyKbMd4jequo9gkwe2otKI",
      authDomain: "fashion-galetora.firebaseapp.com",
      databaseURL: "https://fashion-galetora.firebaseio.com",
      projectId: "fashion-galetora",
      storageBucket: "fashion-galetora.appspot.com",
      messagingSenderId: "469438762797",
      appId: "1:469438762797:web:759f543ce82183b9f04da4",
      measurementId: "G-Q7DJ37H3D0"
    };
    firebase.initializeApp(firebaseConfig);

    let addRegister = new Vue({
      el: '#add-register',
      data: function(){
        return {
          name: '',
          description: '',
          bits: [],
          temp_bit: {
            name: '',
            description: '',
            MCLR: '',
            POBO: '',
            rw: ''
          },
          edit_byte: true,
          hints: new Hints('hints'),
        }
      },
      methods: {
        addBit: function(){
          this.bits.push({
            name: this.temp_bit.name,
            description: this.temp_bit.description,
            MCLR: this.temp_bit.MCLR,
            POBO: this.temp_bit.POBO,
            rw: this.temp_bit.rw,
          })
          this.$forceUpdate()
        },
        clearBit: function(){
          for (var key in this.temp_bit){
            if (this.temp_bit[key].length != 0){
              this.temp_bit[key] = '';
            }
          }
        },
        removeNthBit: function(n){
          let new_bits = [];
          this.bits.forEach((bit, i) => {
            if (n != i){
              new_bits.push(bit)
            }
          });
          this.bits = new_bits;
        },
        clearAll: function(){
          this.name = '';
          this.description = '';
          this.bits = [];
          this.current = '';
        },
        back: function(){
          this.edit_byte = true;
        },
        save: function(){
          firebase.database().ref(`/registers/${this.name}`).set(this.reg)
        },
        registerClickHandler: function(e){
          if (this.edit_byte == true){
            this.hints.show = {head: e.name, body: e.description}
          }else{
            if (e.i != null){
              this.removeNthBit(e.i)
            }
          }
        }
      },
    })
  </script>
  <style type = "text/css">

  </style>

</html>
